<!-- Developed by Saad M. Alqahtan
Electrical Engineering Department
Jubail Industrial College -->
<!DOCTYPE html>
<html>
  <head>
			<title>Online Signals & Systems</title>
      <meta charset="utf-8" />
      <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
      <meta name="viewport" content="width=device-width,initial-scale=1.0" />
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    	<link rel="stylesheet" href="https://pyscript.net/releases/2024.4.1/core.css"> <!--most recent pyscript lib-->
    	<script type="module" src="https://pyscript.net/releases/2024.4.1/core.js"></script> <!--most recent pyscript lib-->
	    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.5.1.min.js"></script>
	    <script type="text/javascript">
	        Bokeh.set_log_level("info");
	    </script>
      <py-config>
				packages = ['sympy','bokeh','numpy']
      </py-config>
  <style>
	.div {
	  /*border: 2px solid; */ padding: 20px; 
	  width: 800px; 
	  height: 350px; 
	  background-color: #FEFFFF;
	  display: inline-block; 
	  margin: 4px 2px; 
	  border-radius: 12px;
	  resize: both;  overflow: auto;"
	}
	</style>
  </head>
  <body style="background-color: #E0E7E9;">
  	<h1 class="w3-h1" style="font-family: Georgia, serif; font-size: 60px; color:#354649;text-align:center;">SignalsVM: Online Basic Visualization and Manipulation of Signals and LTI Systems</h1>
		<div  style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px; font-size: 14px; text-align: center;" class="w3-show-inline-block" >
			<div id="operation" class="w3-bar">
				<p style="flex-wrap: wrap; font-family: Courier New, monospace;">Please click on the type of operation:</pre></p>
				<button id="op1" style="background-color: #6C7A89; width: 200px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" onclick="operation1()" class="w3-btn w3-teal">Signals Visualization</button>
				<button id="op2" style="background-color: #6C7A89; width: 200px; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; font-family: Arial, Helvetica, sans-serif; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 50px;" onclick="operation2()" class="w3-btn w3-teal">Convolution of LTI System</button>
			</div>
		</div>
    <div style="float:left; width: 100%; min-width:405px; min-height: 100px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
	    <div id="signal_option" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
				<p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Select the type of signal:</b>
				<select name="Stype" id="stype"  style="background-color: #FEFFFF; width: 120px; color: #354649; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 14px;" onChange="S_type()">
				  <option value="empty"></option>
				  <option value="Continuous">Continuous</option>
				  <option value="Discrete">Discrete</option>
				</select>
	    </div>
	    <div id="UserInput1c1a" style="float:left; width: 100%; min-width:405px; max-height: 800px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 24px; margin: 4px 2px;">
		    <p style="font-family: Courier New, monospace; flex-wrap: wrap;"><b>Type the signal of interest x(t). For a better visualization, it is recommended to maintain a domain of approx. 100 between the maximum and minimum points.</b></p>
		    <p style="font-family: Courier New, monospace; flex-wrap: wrap;"><b>The signal must be expressed using singularity functions (i.e., u(t) [unit step], rect(t/T) [rectangular function], r(t) [ramp function], delta(t) [dirac delta function]), tri(t) [triangular function] and sgn(t) [signum function] as well as exponential and trigonometric functions:</b></p>
		  </div>
	    <div id="UserInput1c1b" style="float:left; width: 100%; min-width:405px; max-height: 800px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
		    <p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type the signal of interest x(t). For a better visualization, it is recommended to maintain a range of approx. 100 between the maximum and minimum points.</b></p>
		    <p style="font-size: 22px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>The signal must be expressed using singularity functions (i.e., u(t) [unit step], rect(t/T) [rectangular function], r(t) [ramp function], delta(t) [dirac delta function]) and trigonometric functions:</b></p>
		  </div>
	    <div id="UserInput1c2" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
				<p style="flex-wrap: wrap; font-family: Courier New, monospace;">You may chnage any linear axis to logarithmic:</pre>
				<select name="Scale" id="scale"  style="background-color: #FEFFFF; width: 120px; color: #354649; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 14px;" onChange="Scaling()">
					<option value="empty"></option>
				  <option value="Vertical">Vertical</option>
				  <option value="Horizontal">Horizontal</option>
				  <option value="Both">Both</option>
				</select>
				<p style="flex-wrap: wrap; font-family: Courier New, monospace;">Click on "Plot" button when you are ready. Please note:<br>- An exponential function should be expressed as e(***). Example, e^-t = e(-t).</pre></p>
			</div>
	    <div id="UserInput1d" style="float:left; width: 100%; min-width:405px; max-height: 600px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
		    <p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type the signal of interest x[n]. For a better visualization, maintain a range of approx. 20 between the maximum and minimum points.</b></p>
		    <p style="font-size: 22px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Singularity functions (u[n], delta[n]):</b></p>
				<p style="flex-wrap: wrap; font-family: Courier New, monospace;">Click on "Plot" button when you are ready.</pre></p>
			</div>
	    <div id="UserInput1" style="float:left; transform: translateX(5%); width: 90%; text-align: center;">
	    	<input type="text" id="fun1" name="fname" style="font-family: 'DejaVu Math TeX Gyre', serif; font-size: 26px; width: 90%; height: 30%;	 display: inline-block; margin: 4px 2px; border-radius: 5px; border: 0px solid black; text-align: center;"><br><br>
				<button onclick="update1()" py-click="fun1" style="background-color: #6C7A89; width: 10%; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; width: 50px;" onclick="myPlot1()" class="w3-btn w3-black">Plot</button>
				<p id="output1" style="font-size: 24px; font-family: Courier New, monospace; color:#FF0000; text-align: center;"></p>
				<div id="chart1" class="div" style=" color: red; min-width: 5%; min-height: 5%; max-width: 90%; max-height: 75%;"></div>
      </div>
	    </div>
	    <div id="UserInput2c" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
	    	<p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type y(t) as a function of x(t): (Please follow A*x(at+b)+B)</b>
			</div>
	    <div id="UserInput4c" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
	    	<p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type the impulse response h(t) of LTI system:</b>
			</div>
	    <div id="UserInput2d" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
	    	<p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type y[n] as a function of x[n]: (Please follow A*x[an+b]+B)</b>
			</div>
	    <div id="UserInput4d" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
	    	<p style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace;"><b>Type the impulse response h[n] of LTI system:</b>
			</div>
	    <div id="UserInput2" style="float:left; width: 100%; min-width:405px; min-height: 500px; color: #354649; font-size: 14px; margin: 4px 2px;">
		    <div style="float:left; transform: translateX(5%); width: 90%; text-align: center;">
		    	<input type="text" id="fun2" name="fname" style="font-family: 'DejaVu Math TeX Gyre', serif; font-size: 26px; width: 90%; height: 30%;	 display: inline-block; margin: 4px 2px; border-radius: 5px; border: 0px solid black; text-align: center;"><br><br>
					<button onclick="update2()" py-click="fun2" style="background-color: #6C7A89; width: 10%; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; width: 50px;" onclick="myPlot2()" class="w3-btn w3-black">Plot</button>
					<p id="output2" style="font-size: 24px; font-family: Courier New, monospace; color:#FF0000; text-align: center;"></p>
					<div id="chart2" class="div" style=" color: red; min-width: 5%; min-height: 5%; max-width: 90%; max-height: 75%;"></div>
	      </div>
	    </div>
	    <div id="display_control" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px;">
				<select name="Operation_type" id="control"  style="background-color: #FEFFFF; width: 120px; color: #354649; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 16px; margin: 4px 2px; border-radius: 14px;" onChange="Scaling()">
					<option value="empty"></option>
				  <option value="transform"></option>
				  <option value="periodic"></option>
				  <option value="convolve"></option>
				</select>
			</div>
		</div>
		</div>
	  <div class="w3-show-inline-block" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px; font-size: 26px; text-align: center;">
		  <div id="convolution" class="w3-bar">
				<button onclick="update3()" py-click="fun3" onclick="my_convolve()" style="background-color: #6C7A89; width: 40%; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 28px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 60px;" class="w3-btn w3-black">Compute</button>
	  </div>
    <div id="ComputeOutput1" style="float:left; width: 100%; min-width:405px; min-height: 500px; color: #354649; font-size: 14px; margin: 4px 2px;">
    	<p id="ConvCont" style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: left;"><b>y(t) = x(t)*h(t) is shown below:</b>
    	<p id="ConvDisc" style="font-size: 24px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: left;"><b>y[n] = x[n]*h[n] is shown below:</b>
    	<p id="output3" style="font-size: 24px; font-family: Courier New, monospace; color:#FF0000; text-align: center;"></p>
			<div id="chart3" class="div" style=" color: red; min-width: 5%; min-height: 5%; max-width: 90%; max-height: 75%;"></div>
    </div>
	  <div class="w3-show-inline-block" style="float:left; width: 100%; min-width:405px; max-height: 400px; color: #354649; margin-botom: 5px; padding: 5px; font-size: 20px; margin: 4px 2px; font-size: 26px; text-align: center;">
		  <div id="back_reset" class="w3-bar">
				<button onclick="my_back()" style="background-color: #6C7A89; width: 15%; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 60px;" class="w3-btn w3-teal">BACK</button>
				<button onclick="my_reset()" style="background-color: #6C7A89; width: 15%; color: #FEFFFF; margin-botom: 20px; border: none; padding: 10px; display: inline-block; font-size: 14px; margin: 4px 2px; border-radius: 12px; word-wrap: break-word; height: 60px;" class="w3-btn w3-teal">RESET</button>
			</div>
	  </div>
	  <div id = "Counter" style="font-size: 16px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: center;">
	  	<p style="text-align: left;"><b>Important Remarks: </p>
  		<p style=" margin-left: 15px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: left;">- Please wait for around 30 seconds until the webpage is loaded.<br>- If the website is not responding, please try opening it using a different web browser or check if your Internet service provider is blocking the application's executable segment.<br>- To avoid connectivity interruptions, it is highly recommended to embed the website within the learning management system (LMS). For that, please use the below syntax:</p>
  		<input type="text" style="display: flex; justify-content: flex-start; align-items: center; width: 90%; height: 30%;	margin: 4px 2px; border-radius: 5px; border: 0px solid black;" value="<p><iframe width='1400' height='800' src='https://cmd-l.github.io/SignalsVM/' frameborder='0'></iframe></p>" readonly>
			<p style="font-size: 12px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: center;"><b>The number of users:</b></p>
			<div id="sfcm48nx98a6qtlue8uumysmf6c1jzsnwp5"></div>
			<script type="text/javascript" src="https://counter1.optistats.ovh/private/counter.js?c=m48nx98a6qtlue8uumysmf6c1jzsnwp5&down=async" async></script>
			<noscript><a href="https://www.freecounterstat.com" title="html code for visitor counter"><img src="https://counter1.optistats.ovh/private/freecounterstat.php?c=m48nx98a6qtlue8uumysmf6c1jzsnwp5" border="0" title="html code for visitor counter" alt="html code for visitor counter"></a></noscript>
		</div>
	  <p style="font-size: 12px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: center;"><b>Visit our group's site for further detail: <a href="https://github.com/cmd-l/SignalsVM">Link</a></b>
	  <p style="font-size: 12px; flex-wrap: wrap; font-family: Courier New, monospace; text-align: center;"><b>Â©2025 SignalsVM. (ver. 25.1)</b></p>
		<script>
			
			// Variables
		  var scale           = document.getElementById("scale");
		  var fun1            = document.getElementById("fun1");
		  var fun2            = document.getElementById("fun2");
		  var UserInput1      = document.getElementById("UserInput1");
		  var UserInput1c1    = document.getElementById("UserInput1c1");
		  var UserInput1c2    = document.getElementById("UserInput1c2");
		  var UserInput2c     = document.getElementById("UserInput2c");
		  var UserInput4c     = document.getElementById("UserInput4c");
		  var UserInput2      = document.getElementById("UserInput2");
		  var UserInput1d     = document.getElementById("UserInput1d");
		  var UserInput2d     = document.getElementById("UserInput2d");
		  var UserInput4d     = document.getElementById("UserInput4d");
		  var operation       = document.getElementById("operation");
		  var back_reset      = document.getElementById("back_reset");
		  var signal_option   = document.getElementById("signal_option");
		  var stype           = document.getElementById("stype");
		  var display_control = document.getElementById("display_control");
		  var control         = document.getElementById("control");
		  var chart2          = document.getElementById("chart2");
		  var conv            = document.getElementById("convolution");
		  var ComputeOutput1  = document.getElementById("ComputeOutput1");
		  var chart3          = document.getElementById("chart3");
		  var ConvCont        = document.getElementById("ConvCont");
		  var ConvDisc        = document.getElementById("ConvDisc");
		  var Counter         = document.getElementById("Counter");
		  var out             = document.getElementById("out");

		  // Default
		  scale.value                   = "";
		  stype.value                   = "";
		  control.value                 = "";
		  UserInput1.style.display      = "none";
		  UserInput2.style.display      = "none";
		  UserInput1c1a.style.display   = "none";
		  UserInput1c1b.style.display   = "none";
		  UserInput1c2.style.display    = "none";
		  UserInput2c.style.display     = "none";
		  UserInput4c.style.display     = "none";
		  UserInput1d.style.display     = "none";
		  UserInput2d.style.display     = "none";
		  UserInput4d.style.display     = "none";
		  back_reset.style.display      = "none";
		  conv.style.display            = "none";
		  signal_option.style.display   = "none";
		  display_control.style.display = "none";
		  ComputeOutput1.style.display  = "none";

			function S_type() {
				document.getElementById("output1").innerHTML = "";
				document.getElementById("output2").innerHTML = "";
				document.getElementById("output3").innerHTML = "";
				document.getElementById("chart1").innerHTML  = "";
				document.getElementById("chart2").innerHTML  = "";
				document.getElementById("chart3").innerHTML  = "";
			  if (stype.value == "Continuous") {
					  UserInput1d.style.display    = "none";
					  UserInput2d.style.display    = "none";
					  UserInput4d.style.display    = "none";
					  UserInput1.style.display     = "block";
					  UserInput2.style.display     = "block";
					  if (control.value == "transform") {
					  	UserInput1c1a.style.display   = "block";
					  	UserInput1c2.style.display   = "block";
					  	UserInput2c.style.display    = "block";
					  	UserInput4c.style.display    = "none";
					  	conv.style.display           = "none";
					  	fun1.value                   = "u(t)-u(t-1)";
					  	fun2.value                   = "2*x(-t/2+2)+1";
					  } else if (control.value == "convolve") {
					  	UserInput1c1b.style.display  = "block";
					  	UserInput1c2.style.display   = "none";
					  	UserInput2c.style.display    = "none";
					  	UserInput4c.style.display    = "block";
					  	conv.style.display           = "block";
					  	ComputeOutput1.style.display = "block";
					  	ConvCont.style.display       = "block";
					  	ConvDisc.style.display       = "none";
					  	fun1.value                   = "r(t)-r(t-1)-u(t-1)";
					  	fun2.value                   = "u(t)-u(t-2)";
					  }
			  	} else if (stype.value == "Discrete"){
					  UserInput1c1a.style.display  = "none";
					  UserInput1c1b.style.display  = "none";
					  UserInput1c2.style.display   = "none";
					  UserInput2c.style.display    = "none";
					  UserInput4c.style.display    = "none";
					  UserInput1.style.display     = "block";
					  UserInput2.style.display     = "block";
					  UserInput1d.style.display    = "block";
					  scale.value                   = "";
					  if (control.value == "transform") {
					  	UserInput2d.style.display    = "block";
					  	UserInput4d.style.display    = "none";
					  	conv.style.display           = "none";
						  fun1.value                   = "2*delta[n-1]+3.5*delta[n-2]+5*delta[n-3]";
						  fun2.value                   = "2*x[-n+2]+1";
					  } else if (control.value == "convolve") {
					  	UserInput2d.style.display    = "none";
					  	UserInput4d.style.display    = "block";
					  	conv.style.display           = "block";
					  	ComputeOutput1.style.display = "block";
					  	ConvCont.style.display       = "none";
					  	ConvDisc.style.display       = "block";
					  	fun1.value                   = "0.5*delta[n]+delta[n-2]";
					  	fun2.value                   = "0.2*delta[n-1]+delta[n-2]";
					  }
			  	} else {
					  UserInput1c1a.style.display  = "none";
					  UserInput1c1b.style.display  = "none";
					  UserInput1c2.style.display   = "none";
					  UserInput2c.style.display    = "none";
					  UserInput4c.style.display    = "none";
					  UserInput1.style.display     = "none";
					  UserInput2.style.display     = "none";
					  UserInput1d.style.display    = "none";
					  UserInput2d.style.display    = "none";
					  UserInput4d.style.display    = "none";
				  	ComputeOutput1.style.display = "none";
					  conv.style.display          = "none";
					  fun1.value                   = "";
					  fun2.value                   = "";
			  	}
			  }

			function operation1() {
				operation.style.display     = "none";
				signal_option.style.display = "block";
			  back_reset.style.display    = "block";
			  control.value               = "transform";
			  Counter.style.display       = "none";
			}
			
			function operation2() {
				operation.style.display     = "none";
				signal_option.style.display = "block";
			  back_reset.style.display    = "block";
			  control.value               = "convolve";
			  Counter.style.display       = "none";
			}

			function my_back() {
				signal_option.style.display = "none";
			  UserInput1c1a.style.display = "none";
			  UserInput1c1b.style.display = "none";
			  UserInput1c2.style.display  = "none";
			  UserInput2c.style.display   = "none";
			  UserInput4c.style.display   = "none";
			  UserInput1.style.display    = "none";
			  UserInput2.style.display    = "none";
			  UserInput1d.style.display   = "none";
			  UserInput2d.style.display   = "none";
			  UserInput4d.style.display   = "none";
			  conv.style.display          = "none";
			  back_reset.style.display    = "none";
				operation.style.display     = "block";
				Counter.style.display       = "block";
			  stype.value                 = "";
			  scale.value                 = "";
			  control.value               = "";
			  ComputeOutput1.style.display= "none";
			}
			
			function my_reset() {
				document.getElementById("output1").innerHTML = "";
				document.getElementById("output2").innerHTML = "";
				document.getElementById("output3").innerHTML = "";
				document.getElementById("chart1").innerHTML  = "";
				document.getElementById("chart2").innerHTML  = "";
				document.getElementById("chart3").innerHTML  = "";
			  scale.value                 = "";
			}

			function update1() {
				document.getElementById("chart1").innerHTML  = "";
			}

			function update2() {
				document.getElementById("chart2").innerHTML  = "";
			}

			function update3() {
				document.getElementById("chart3").innerHTML  = "";
			}

		</script>
    <script type="py" async>
			from sympy import lambdify,sin,cos,sinc,exp,pi,DiracDelta,\
												Heaviside,expand,symbols,tan,cot,sec,csc,\
												asin,acos,atan,acot,asec,acsc,\
												sinh,cosh,tanh,coth,sech,csch,\
												sympify, preorder_traversal, solve,\
												integrate, oo, simplify, Integral, sqrt,Abs
			import re
			import math
			from bokeh.models import FuncTickFormatter

			import numpy as np
			from bokeh.plotting import figure, column
			from bokeh.models import ColumnDataSource, CustomJS
			from bokeh.embed import json_item
			from pyscript import window, document, fetch, ffi
			import warnings
			warnings.filterwarnings("ignore")

			# Pre-defined Functions
			def rect(t,T=1): return (Heaviside((t + T/2)) - Heaviside((t - T/2))) # rect
			def r(t): return t*Heaviside(t)                               # ramp
			def tri(t,T=1): return (1-Abs(t)/T)*rect(t,T*2) # Tri
			def sgn(t): return Heaviside(t)-Heaviside(-t)   # Signum
			def delta_num(t):																# Delta (Numerical)
			    return np.where(np.isclose(t, 0.0, atol=1e-10), 1.0, 0.0)
			def unit_num(t,h=0.5):													# Unit Step (Numerical)
			    return np.where(t >= 0, 1.0, np.where(t < 0, 0.0, h))

			def assign_period(fun):
				t1 = re.findall(f"[rect|tri]\((.*?)\)", fun)
				tx = []
				for i in range(len(t1)):
					if '-' in t1[i] or '+' in t1[i]:
						fun = fun.replace(t1[i],t1[i].replace('/','XXXX'))
					else:
						tx.append(t1[i])

				for i in range(len(tx)):
					fun = fun.replace(tx[i],tx[i].replace('/',','))


				fun = fun.replace('XXXX','/')

				t2 = re.findall(f"[rect|tri]\(\((.*?)\)(.*?)\)", fun)
				for i in range(len(t2)):
					for j in range(len(t2[i])):
						if '/' in t2[i][j]:
							tt = t2[i][j-1]+')'+t2[i][j]
							fun = fun.replace(tt,tt.replace('/',','))
				
				return fun

			def initial_func(fun):                                        # Map to defined functions
				# Replace some functions to a defined ones
				fun_new = fun.lower().replace('[', '(').replace(']', ')').replace('e(', 'exp(').replace('u(', 'Heaviside(').replace('delta(', 'DiracDelta(').replace('^','**')
				if 'rect' in fun_new or 'tri' in fun_new:
					fun_new = assign_period(fun_new)
				return fun_new , fun

			# Apply Transformation
			def transformation(x,y):
				y = "".join(y.split()).replace('[', '((').replace(']', '))').replace(')', '))').replace('(', '((')
				trans = re.search(f"(.*)x[(](.*)[)](.*)", y)

				# Controling the expression of transformation to a specific format A*x(t)+B or A*x(t)-B
				if ("*" not in trans[1] and trans[1] != '') or ("+" not in trans[3] and "-" not in trans[3] and trans[3] != ''):
					raise ValueError("Either unexpected error in your function x(t) or y(t)!!")

				# Assign default values if the amplitude transformation does not exist
				try: A = eval(trans[1][:-1])
				except: A = 1
				try: B = eval(trans[3])
				except:B = 0

				# Time-transformation
				y0 = x.replace("rect","rec").replace("DiracDelta","dela").replace("tan","XXX").replace("cot","YYY").replace("sin","ZZZ").replace("tri","ri").replace("sgn","sg")
				y1 = y0.replace('t',trans[2]).replace('n',trans[2])
				y2 = y1.replace("rec","rect").replace("dela","DiracDelta").replace("XXX","tan").replace("YYY","cot").replace("ZZZ","sin").replace("ri","tri").replace("sg","sgn")
				y3 = eval(y2)

				# Get time transformations separately
				t1  = re.findall(f"([\D]0.\d+\D[t|n]|[\D]\d+\D[t|n])", y)
				t2  = re.findall(f"([\D][t|n][\D|^/]\d+.\d+|[t|n][^/]\d+)", y)
				if len(t2) > 0:
					if "*t+" in t2[0] or "*t-" in t2[0]:
						t2 = []
				t3  = re.findall(f"([t|n]/0.\d+|[t|n]/\d+)", y)
				t4 = re.findall(f"([+|-][t|n]/0.\d+|[+|-][t|n]/\d+)", y)
				tsr = t1 + t2 + t3 + t4

				ts  = re.findall(f"([+|-]\d+.\d+|[+|-]\d+\D)", y)

				divide = 1
				multi  = 1
				t5 = re.findall(f"([+|-][t|n])", y)
				if len(tsr) == 0 and len(t5) > 0:
					multi = eval(t5[0].replace("t","1").replace("n","1"))
				try: shift = eval(ts[len(ts)-1].replace(")",""))
				except: shift = 0
				for sr in tsr:
					tmp = sr.replace("t","").replace("n","").replace("*","").replace("/","").replace("(","").replace("[","")
					if "/" in sr:
						divide = eval(tmp)
					elif "*" in sr:
						multi  = eval(tmp)

				# All Transformations
				return f"{A}*({y2})+{B}",A*y3+B,divide,multi,shift


			def convolve(x,h,signal_type):
				# Functions Adjustment
				x = x.replace('[', '(').replace(']', ')')
				h = h.replace('[', '(').replace(']', ')')

				x = eval(x)
				h = eval(h)

				if signal_type == "Continuous": y = integrate(x.subs(t,tau) * h.subs(t,t-tau), (tau, -oo, t))
				else: y = integrate(x.subs(n,k) * h.subs(n,n-k), (k, -oo,n))
				y = simplify(y)

				# Output
				return y


			# Convert symbolic to numerical list
			def sym_num(x,fun,signal_type,divide=1,multi=1,shift=0):
				try:
					num_fun = {'DiracDelta': delta_num, 'Heaviside': unit_num}
					if signal_type == "Discrete":
						f = lambdify(n, x, modules=[num_fun, 'numpy'])
					else:
						f = lambdify(t, x, modules=[num_fun, 'numpy'])
					
					# Specify time limits and dt
					shifts = np.array([eval(i.replace("t","").replace("n","").replace(")","").replace("]",""))*-1 for i in re.findall(f"[n|t][+|-]\d+\D", "".join(fun.split()))])
					fun0 = fun.replace("rect","rec").replace("DiracDelta","dela").replace("tan","XXX").replace("cot","YYY").replace("sin","ZZZ").replace("tri","ri").replace("sgn","sg")
					zeros  = re.findall(r"[+|-]\d+|\D[t|n]\D|", "".join(fun0.split()))
					if "(t)" in zeros or "(n)" in zeros:
						shifts = np.append(shifts,0)

					scaling  = divide/multi
					shifting = shift*scaling

					try:
						if scaling == 1 and shifting == 0:
							mini = math.floor(int(min(shifts))-2)
							maxi = math.ceil(int(max(shifts))+2)
						elif scaling > 0:
							mini = math.floor(int(min(shifts))*scaling-2-shifting)
							maxi = math.ceil(int(max(shifts))*scaling+2-shifting)
						elif scaling < 0:
							mini = math.floor(int(max(shifts))*scaling-2-shifting)
							maxi = math.ceil(int(min(shifts))*scaling+2-shifting)
					except:
						mini = -15
						maxi = +15
				except:
					if signal_type == "Discrete":
						f = lambdify(n, x*(Heaviside(n)+Heaviside(-n)), modules=[num_fun, 'numpy'])
					else:
						f = lambdify(t, x*(Heaviside(t)+Heaviside(-t)), modules=[num_fun, 'numpy'])
					mini = -20
					maxi =  20
				dt   = int(round((abs(mini)+abs(maxi))/0.001,0))
				
				# Specify the axis based on the function
				is_radian = any(i in fun for i in trig_list)
				if signal_type == "Discrete":
					time = np.array([i for i in range(mini,maxi)])
					is_radian = False
				elif is_radian:
					time = np.linspace(mini*np.pi,maxi*np.pi,dt)
				else:
					time = np.linspace(mini,maxi,dt)
									
				# Concatenate all extracted shifts to specify the domain
				if signal_type == "Continuous": 
					time = np.unique(np.concatenate([time,np.array([i for i in range(mini,maxi)])]))
				# Extract the function
				f = f(time)


				return time, f, mini, maxi, is_radian

			# Symbolic Variable
			t, n, tau, k = symbols('t n tau k')

			# Trig. List
			trig_list = ["sin","cos","tan","cot","sec","csc"]


			# Scale type
			def scaling(scale_type, is_radian):
				# Scaling of the axes
				if scale_type == "Vertical" or scale_type == "Both":
					x_scale = "linear"
					y_scale = "log"
				elif scale_type == "Horizontal" and not is_radian:
					x_scale = "log"
					y_scale = "linear"
				else:
					x_scale = "linear"
					y_scale = "linear"
				return x_scale, y_scale


			Bokeh = window.Bokeh   #pass Bokeh into the main threads window object

			async def plotting(time,f,mini,maxi,fun,chart,is_radian,x_scale,y_scale,signal_type):
				source = ColumnDataSource(data = dict(x=time.tolist(),y=f))

				if signal_type == "Continuous":
					axes = [("Time","$x"),("x(t)","$y")]

					p  = figure(x_range=(mini,maxi), width=800, height=450, tooltips=axes, 
										sizing_mode="stretch_both", x_axis_type=x_scale, y_axis_type=y_scale)
					p.line('x', 'y', source=source, line_width=3, line_alpha=0.6, color="blue", legend_label=f"{fun}")
				else:
					axes = [("n","$x"),("x[n]","$y"),]

					p  = figure(x_range=(mini,maxi), width=800, height=450, tooltips=axes, 
										sizing_mode="stretch_both", x_axis_type=x_scale, y_axis_type=y_scale)
					p.segment(x0=time, y0=0, x1=time, y1=f, line_width=2, line_color="blue", legend_label=f"{fun}")
					p.circle(time, np.array(f), color="blue", fill_alpha=0.8)
				p.legend.location = "top_left"
				p.legend.click_policy="hide"
				p.yaxis.axis_label = fun
				document.querySelector(f"#{chart}").replaceChildren()
				
				# Specify the axis based on the function
				if abs(maxi - mini) >= 1000:
					steps = 200
				elif abs(maxi - mini) >= 100:
					steps = 20
				elif abs(maxi - mini) >= 50:
					steps = 10
				elif abs(maxi - mini) >= 20:
					steps = 5
				else:
					steps = 1
				if signal_type != "Continuous":
					p.xaxis.axis_label = "n"
					p.xaxis.ticker = [i for i in range(mini, maxi+1,steps)]
				else:
					p.xaxis.axis_label = "Time [s]"
					p.xaxis.ticker = [i for i in range(mini, maxi+1,steps)]


				await Bokeh.embed.embed_item(ffi.to_js(json_item(p, f"{chart}")))

			async def fun1(event):
				# 1st function
				fun, fun_old = initial_func(document.querySelector("#fun1").value)
				scale_type   = document.querySelector("#scale").value
				signal_type  = document.querySelector("#stype").value


				# Output variable
				output_div = document.querySelector("#output1")
				#output_div.innerText =  f"x(t) = {fun}"
				try:
					# Evaluate the function
					x = eval(fun)

					# Specify the minimum and maximum t-axis
					time, f, mini, maxi, is_radian = sym_num(x,fun,signal_type)

					# Select the scale type
					if signal_type == "Continuous":
						x_scale, y_scale = scaling(scale_type, is_radian)
					else:
						x_scale, y_scale  = ("linear","linear")

					# Plotting the function
					if signal_type == "Continuous":
						await plotting(time,f,mini,maxi,"x(t)","chart1",is_radian,x_scale,y_scale,signal_type)
					else:
						await plotting(time,f,mini,maxi,"x[n]","chart1",is_radian,x_scale,y_scale,signal_type)
					output_div.innerText =  "" #f"x(t) = {fun}"
					
				except:
					if signal_type == "Continuous":
						output_div.innerText = "Unexpected error in your function x(t)!! or the answer is zero!!"
					else:
						output_div.innerText = "Unexpected error in your function x[n]!! or the answer is zero!!"
				

			async def fun2(event):
				# 2nd function
				control      = document.querySelector("#control").value
				signal_type  = document.querySelector("#stype").value
				if control == "transform":
					initial_fun, fun = initial_func(document.querySelector("#fun1").value)
					scale_type   = document.querySelector("#scale").value
					# 2nd function
					fun_new = document.querySelector("#fun2").value
				elif control == "convolve":
					fun, fun_old = initial_func(document.querySelector("#fun2").value)
					scale_type   = ""

				if signal_type == "Continuous" and control != "convolve": chfun   = "y(t)"
				elif signal_type == "Discrete" and control != "convolve": chfun   = "y[n]"
				elif signal_type == "Continuous" and control == "convolve": chfun = "h(t)"
				elif signal_type == "Discrete" and control == "convolve": chfun   = "h[n]"


				output_div = document.querySelector("#output2")

				try:
					if control == "transform": f, y,divide,multi,shift = transformation(initial_fun,fun_new)
					else: 
						y = eval(fun) 
						divide =1 
						multi = 1 
						shift = 0

					# Specify the minimum and maximum t-axis
					time, f, mini, maxi, is_radian = sym_num(y,fun,signal_type,divide,multi,shift)

					# Select the scale type
					x_scale, y_scale = scaling(scale_type, is_radian)

					# Plotting the function
					if signal_type == "Continuous":
						await plotting(time,f,mini,maxi,chfun,"chart2",is_radian,x_scale,y_scale,signal_type)
					else:
						await plotting(time,f,mini,maxi,chfun,"chart2",is_radian,x_scale,y_scale,signal_type)
					output_div.innerText = "" #f"{chfun} = {fun}"

				except: 
					if signal_type == "Continuous" and control == "transform":
							output_div.innerText = f"Either unexpected error in your function x(t) or {chfun}!!\n Please Try to type it as A*x(at+b)+B"
					elif signal_type == "Discrete" and control == "transform":
							output_div.innerText = f"Either unexpected error in your function x[n] or {chfun}!!\n Please Try to type it as A*x[an+b]+B"
					if signal_type == "Continuous" and control == "convolve":
							output_div.innerText = f"Unexpected error in your function {chfun}!!"
					elif signal_type == "Discrete" and control == "convolve":
							output_div.innerText = f"Unexpected error in your function {chfun}!!"

			async def fun3(event):
				# 3rd function
				control     = document.querySelector("#control").value
				signal_type = document.querySelector("#stype").value
				x, x_old    = initial_func(document.querySelector("#fun1").value)
				h, h_old    = initial_func(document.querySelector("#fun2").value)
				scale_type  = ""

				if signal_type == "Continuous" and control == "convolve": chfun   = "y(t)"
				elif signal_type == "Discrete" and control == "convolve": chfun   = "y[n]"

				output_div = document.querySelector("#output3")

				try:
					y = convolve(x,h,signal_type)

					# Specify the minimum and maximum t-axis
					time, f, mini, maxi, is_radian = sym_num(y,str(y),signal_type)

					# Select the scale type
					x_scale, y_scale = scaling(scale_type, is_radian)

					output_div.innerText = "" #f"{chfun} = {str(y)}"

					# Plotting the function
					if signal_type == "Continuous":
						await plotting(time,f,mini,maxi,chfun,"chart3",is_radian,x_scale,y_scale,signal_type)
					else:
						await plotting(time,f,mini,maxi,chfun,"chart3",is_radian,x_scale,y_scale,signal_type)

				except: 
					if signal_type == "Continuous":
						output_div.innerText = "Unexpected error, please avoid using tri and sgn functions and ensure that the x(t) and the h(t) are properly typed!!"
					else:
						output_div.innerText = "Unexpected error, please make sure that the x[n] and the h[n] are properly typed!!"

			async def update_data(event):
				await fun1()
				await fun2()
				await fun3()
    </script>
  </body>
</html>